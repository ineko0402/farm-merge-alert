<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>アラーム管理</title>
  <link rel="stylesheet" href="style.css" />
  <!-- <link rel="icon" href="favicon_32x32" type="image/png" sizes="32x32"> -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#5b21b6">
  <link rel="icon" href="icon-192.png">
  <script>
    // Service Worker 登録
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
  <script>
  (function() {
    // 開発モード判定
    // あなたの開発用URLに合わせてここを編集
    const isDev = location.hostname.includes('github.io') || location.hostname === 'localhost' || location.protocol === 'file:';

    if (isDev) {
      // キャッシュ無効化（CSS・JS・manifest）
      const version = '?v=' + Date.now();
      const links = document.querySelectorAll('link[rel="stylesheet"], link[rel="manifest"]');
      const scripts = document.querySelectorAll('script[src]');
      [...links, ...scripts].forEach(el => {
        if (el.href) el.href += version;
        if (el.src) el.src += version;
      });
      console.log('💡 開発モード: キャッシュ無効化中 (' + location.hostname + ')');

      // Service WorkerとCache削除
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(r => r.forEach(x => x.unregister()));
        caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
        console.log('⚠️ Service Worker / Cache 削除済み');
      }
    }
  })();
</script>

</head>
<body>
  <header>
  <h1>アラーム管理</h1>
  <div class="notif-controls">
    <button id="enableNotif">通知とサウンドを有効化</button>
    <button id="halfEventButton" class="event-btn">作業・回復時間短縮イベント中</button>
  </div>
  </header>


  <main>
    <div class="two-col">
      <!-- エネルギー回復アラーム -->
      <section class="card energy">
        <h2>エネルギー回復</h2>

        <!-- 初期/停止中UI -->
        <div id="energyInputUI">
          <label>現在エネルギー（0〜50）</label>
          <input id="curEnergy" type="number" min="0" max="50" value="0" />
          <button id="startEnergy">開始</button>
          <div class="muted" id="energyHint">設定後に残り時間が表示されます。</div>
        </div>

        <!-- アラーム中UI -->
        <div id="energyActiveUI" class="hidden">
          <div class="timer" id="energyRemain">—:—:—</div>
          <div class="pill" id="energyTarget">目標時刻: —</div>
          <div class="muted">到達すると通知します。</div>
          <div class="buttons">
            <button id="stopEnergy">停止</button>
            <button id="resetEnergy">リセット</button>
          </div>
        </div>
      </section>

      <!-- 物資アラーム -->
      <section class="card supply">
        <h2>物資</h2>

        <!-- 初期/停止中UI -->
        <div id="supplyInputUI">
          <label>現在物資数（0〜40）</label>
          <input id="curSupply" type="number" min="0" max="40" value="0" />
          <button id="startSupply">開始</button>
          <div class="muted" id="supplyHint">設定後に残り時間が表示されます。</div>
        </div>

        <!-- アラーム中UI -->
        <div id="supplyActiveUI" class="hidden">
          <div class="timer" id="supplyRemain">—:—:—</div>
          <div class="pill" id="supplyTarget">満杯時刻: —</div>
          <div class="pill" id="supplyAlert">36個超過: —</div>
          <div class="muted">到達すると通知します。</div>
          <div class="buttons">
            <button id="stopSupply">停止</button>
            <button id="resetSupply">リセット</button>
          </div>
        </div>
      </section>
    </div>

    <!-- 労働者アラーム -->
    <section class="card workers">
      <h2>労働者アラーム</h2>
      <div class="preset-bar" id="workerPresetButtons">
        <button data-min="3" data-label="3分">3分</button>
        <button data-min="5" data-label="5分">5分</button>
        <button data-min="8.33" data-label="8分20秒">8分20秒</button>
        <button data-min="15" data-label="15分">15分</button>
        <button data-min="30" data-label="30分">30分</button>
        <button data-min="50" data-label="50分">50分</button>
        <button data-min="80" data-label="1時間20分">1時間20分</button>
        <button data-min="120" data-label="2時間">2時間</button>
      </div>
      <div id="workerList"></div>
    </section>
  </main>

  <script src="script.js"></script>
</body>
</html>
