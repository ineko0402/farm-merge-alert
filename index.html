<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <title>アラーム管理</title>
  <link rel="stylesheet" href="style.css" />
  <!-- <link rel="icon" href="favicon_32x32" type="image/png" sizes="32x32"> -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#5b21b6">
  <link rel="icon" href="icon-192.png">
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
  <script src="//www.midijs.net/lib/midi.js"></script>
  <script>
    // Service Worker 登録
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
  <script>
    (function () {
      const isDev = location.hostname === '127.0.0.1';

      if (isDev) {
        // キャッシュ無効化（CSS・JS・manifest）
        const version = '?v=' + Date.now();
        const links = document.querySelectorAll('link[rel="stylesheet"], link[rel="manifest"]');
        const scripts = document.querySelectorAll('script[src]');
        [...links, ...scripts].forEach(el => {
          if (el.href) el.href += version;
          if (el.src) el.src += version;
        });
        console.log('💡 開発モード: キャッシュ無効化中 (' + location.hostname + ')');

        // Service WorkerとCache削除
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(r => r.forEach(x => x.unregister()));
          caches.keys().then(keys => keys.forEach(k => caches.delete(k)));
          console.log('⚠️ Service Worker / Cache 削除済み');
        }
      }
    })();
  </script>

</head>

<body>
  <header>
    <h1>アラーム管理</h1>
    <div class="notif-controls">
      <a href="settings.html" class="settings-link" title="設定">
        <span class="material-symbols-outlined">settings</span>
      </a>
      <button id="enableNotif" title="通知モード">
        <span class="material-symbols-outlined">notifications</span>
        <span class="btn-text">通知を有効にする</span>
      </button>
      <button id="halfEventButton" class="event-btn" title="イベント切り替え">
        <span class="material-symbols-outlined">bolt</span>
        <span class="btn-text">作業・回復時間短縮イベント中</span>
      </button>
    </div>
  </header>


  <main>
    <div class="two-col">
      <!-- エネルギー回復アラーム -->
      <section class="card energy">
        <h2>エネルギー回復</h2>
        <!-- 初期/停止中UI -->
        <div id="energyInputUI">
          <label>現在エネルギー</label>
          <div class="input-bar">
            <input id="curEnergy" type="number" min="0" max="50" value="0" placeholder="0〜50" />
            <button id="startEnergy">開始する</button>
          </div>
        </div>

        <!-- アラーム中UI -->
        <div id="energyActiveUI" class="hidden">
          <div class="timer" id="energyRemain">—:—:—</div>
          <div class="pill" id="energyTarget">目標時刻: —</div>
          <div class="muted">到達すると通知します。</div>
          <div class="buttons">
            <button id="stopEnergy">停止</button>
            <button id="resetEnergy">リセット</button>
          </div>
        </div>
      </section>

      <!-- 物資アラーム -->
      <section class="card supply">
        <h2>物資</h2>
        <!-- 初期/停止中UI -->
        <div id="supplyInputUI">
          <label>現在物資数</label>
          <div class="input-bar">
            <input id="curSupply" type="number" min="0" max="40" value="0" placeholder="0〜40" />
            <button id="startSupply">開始する</button>
          </div>
        </div>

        <!-- アラーム中UI -->
        <!-- 物資アラーム中UI -->
        <div id="supplyActiveUI" class="hidden">
          <div class="timer" id="supplyRemain">—:—:—</div>
          <div class="pill" id="supplyTarget">36個到達: —</div>
          <div class="muted">36個到達で通知します</div>
          <div class="buttons">
            <button id="stopSupply">停止</button>
            <button id="resetSupply">リセット</button>
          </div>
        </div>
      </section>
    </div>

    <!-- 労働者アラーム -->
    <section class="card workers">
      <h2>労働者アラーム</h2>
      <div class="preset-bar" id="workerPresetButtons">
        <button data-min="3"><span class="label">3分</span></button>
        <button data-min="5"><span class="label">5分</span></button>
        <button data-min="8.33"><span class="label">8分20秒</span></button>
        <button data-min="15"><span class="label">15分</span></button>
        <button data-min="30"><span class="label">30分</span></button>
        <button data-min="50"><span class="label">50分</span></button>
        <button data-min="80"><span class="label">1時間20分</span></button>
        <button data-min="120"><span class="label">2時間</span></button>
      </div>
      <div id="workerList"></div>
    </section>
  </main>

  <footer>
    <!-- Credits moved to settings.html -->
  </footer>

  <script src="shared-audio.js"></script>
  <script src="script.js"></script>
</body>

</html>